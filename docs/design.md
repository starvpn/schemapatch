# SchemaPatch - MySQLæ•°æ®åº“å¯¹æ¯”ä¸å‡çº§å·¥å…·è®¾è®¡æ–¹æ¡ˆ

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®åç§°**: SchemaPatch  
**æŠ€æœ¯æ ˆ**: Go + Fyne GUI + Docker  
**ç›®æ ‡**: æä¾›å¼€å‘/ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“ç»“æ„å¯¹æ¯”ã€å‡çº§SQLç”Ÿæˆã€è™šæ‹Ÿç¯å¢ƒéªŒè¯çš„ä¸€ç«™å¼è§£å†³æ–¹æ¡ˆ

---

## äºŒã€ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        GUI Layer (Fyne v2.7.x)                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ç¯å¢ƒé…ç½®  â”‚ â”‚å·®å¼‚å¯¹æ¯”  â”‚ â”‚è„šæœ¬é¢„è§ˆ  â”‚ â”‚éªŒè¯æ‰§è¡Œ  â”‚ â”‚æŠ¥å‘Šå¯¼å‡ºâ”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Core Service Layer                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚Schema Extractorâ”‚ â”‚ Diff Engine â”‚  â”‚ SQL Generator        â”‚   â”‚
â”‚  â”‚  (å…ƒæ•°æ®æå–) â”‚  â”‚  (å·®å¼‚åˆ†æ)  â”‚  â”‚  (å‡çº§è„šæœ¬ç”Ÿæˆ)      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚Docker Manager â”‚  â”‚  Validator  â”‚  â”‚ Report Generator     â”‚   â”‚
â”‚  â”‚  (å®¹å™¨ç®¡ç†)   â”‚  â”‚  (è„šæœ¬éªŒè¯)  â”‚  â”‚  (æŠ¥å‘Šç”Ÿæˆ)          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Infrastructure Layer                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ MySQL Driver â”‚  â”‚ Docker SDK  â”‚  â”‚ Config Store         â”‚   â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚ (YAML/SQLite)        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸‰ã€æ ¸å¿ƒæ¨¡å—è¯¦ç»†è®¾è®¡

### 3.1 ç¯å¢ƒé…ç½®æ¨¡å— (`config`)

**èŒè´£**: ç®¡ç†å¤šç¯å¢ƒæ•°æ®åº“è¿æ¥é…ç½®

```go
// æ•°æ®ç»“æ„è®¾è®¡
type Environment struct {
    ID          string            // å”¯ä¸€æ ‡è¯†
    Name        string            // ç¯å¢ƒåç§° (å¦‚: "å¼€å‘ç¯å¢ƒ", "ç”Ÿäº§ç¯å¢ƒ")
    Type        EnvironmentType   // dev / staging / prod
    Host        string
    Port        int
    Username    string
    Password    string            // åŠ å¯†å­˜å‚¨
    Database    string
    Charset     string            // é»˜è®¤ utf8mb4
    MySQLVersion string           // å¦‚ 8.0.35
    SSLEnabled  bool
    SSLConfig   *SSLConfig        // å¯é€‰çš„SSLé…ç½®
}

type Project struct {
    ID           string
    Name         string
    Environments []Environment
    IgnoreRules  IgnoreConfig      // å¿½ç•¥è§„åˆ™
    CreatedAt    time.Time
    UpdatedAt    time.Time
}

type IgnoreConfig struct {
    Tables      []string          // å¿½ç•¥çš„è¡¨å (æ”¯æŒé€šé…ç¬¦)
    Columns     []string          // å¿½ç•¥çš„åˆ— (æ ¼å¼: table.column)
    Indexes     []string          // å¿½ç•¥çš„ç´¢å¼•
    IgnoreComments      bool      // æ˜¯å¦å¿½ç•¥æ³¨é‡Šå˜æ›´
    IgnoreAutoIncrement bool      // æ˜¯å¦å¿½ç•¥è‡ªå¢å€¼å˜æ›´
    IgnoreCollation     bool      // æ˜¯å¦å¿½ç•¥å­—ç¬¦é›†å˜æ›´
}
```

### 3.2 Schema æå–æ¨¡å— (`extractor`)

**èŒè´£**: ä»MySQLæ•°æ®åº“æå–å®Œæ•´çš„schemaå…ƒæ•°æ®

**æ”¯æŒçš„å¯¹è±¡ç±»å‹**:

| å¯¹è±¡ç±»å‹ | æå–å†…å®¹ |
|---------|---------|
| è¡¨ (Tables) | è¡¨åã€å¼•æ“ã€å­—ç¬¦é›†ã€æ³¨é‡Šã€åˆ†åŒºä¿¡æ¯ |
| åˆ— (Columns) | åˆ—åã€ç±»å‹ã€æ˜¯å¦ä¸ºç©ºã€é»˜è®¤å€¼ã€è‡ªå¢ã€æ³¨é‡Š |
| ç´¢å¼• (Indexes) | ä¸»é”®ã€å”¯ä¸€ç´¢å¼•ã€æ™®é€šç´¢å¼•ã€å…¨æ–‡ç´¢å¼• |
| å¤–é”® (Foreign Keys) | å¼•ç”¨å…³ç³»ã€çº§è”è§„åˆ™ |
| è§†å›¾ (Views) | å®šä¹‰SQLã€ä¾èµ–å…³ç³» |
| å­˜å‚¨è¿‡ç¨‹/å‡½æ•° | å®šä¹‰ã€å‚æ•°ã€æƒé™ |
| è§¦å‘å™¨ (Triggers) | è§¦å‘æ—¶æœºã€è§¦å‘äº‹ä»¶ã€å®šä¹‰ |

```go
// æ ¸å¿ƒæ¥å£
type SchemaExtractor interface {
    Connect() error
    Close() error
    ExtractSchema(options ExtractOptions) (*DatabaseSchema, error)
    GetServerVersion() (string, error)
    GetServerVariables() (map[string]string, error)
}

type DatabaseSchema struct {
    Database    string
    Charset     string
    Collation   string
    Tables      map[string]*TableSchema
    Views       map[string]*ViewSchema
    Procedures  map[string]*ProcedureSchema
    Functions   map[string]*FunctionSchema
    Triggers    map[string]*TriggerSchema
    ExtractedAt time.Time
}
```

### 3.3 å·®å¼‚åˆ†æå¼•æ“ (`diff`)

**èŒè´£**: å¯¹æ¯”ä¸¤ä¸ªSchemaï¼Œç”Ÿæˆç»“æ„åŒ–çš„å·®å¼‚æŠ¥å‘Š

**å·®å¼‚ç±»å‹**:

```go
type DiffType int

const (
    DiffTypeAdded    DiffType = iota  // æ–°å¢
    DiffTypeRemoved                    // åˆ é™¤
    DiffTypeModified                   // ä¿®æ”¹
)

type DiffSeverity int

const (
    SeverityInfo     DiffSeverity = iota  // ä¿¡æ¯ (å¦‚æ³¨é‡Šå˜æ›´)
    SeverityWarning                        // è­¦å‘Š (å¦‚ç±»å‹æ‰©å±•)
    SeverityDanger                         // å±é™© (å¦‚åˆ é™¤åˆ—/è¡¨ã€ç±»å‹æ”¶ç¼©)
)

type SchemaDiff struct {
    SourceEnv    string
    TargetEnv    string
    TableDiffs   []TableDiff
    ViewDiffs    []ViewDiff
    ProcDiffs    []ProcedureDiff
    TriggerDiffs []TriggerDiff
    Statistics   DiffStatistics
    GeneratedAt  time.Time
}

type TableDiff struct {
    TableName    string
    DiffType     DiffType
    Severity     DiffSeverity
    ColumnDiffs  []ColumnDiff
    IndexDiffs   []IndexDiff
    FKeyDiffs    []ForeignKeyDiff
    Description  string
}

type ColumnDiff struct {
    ColumnName   string
    DiffType     DiffType
    Severity     DiffSeverity
    OldDefinition *ColumnDefinition
    NewDefinition *ColumnDefinition
    RiskNote     string            // é£é™©æç¤º
}
```

**é£é™©æ£€æµ‹è§„åˆ™**:

| å˜æ›´ç±»å‹ | é£é™©ç­‰çº§ | è¯´æ˜ |
|---------|---------|------|
| åˆ é™¤è¡¨ | ğŸ”´ å±é™© | æ•°æ®å°†æ°¸ä¹…ä¸¢å¤± |
| åˆ é™¤åˆ— | ğŸ”´ å±é™© | è¯¥åˆ—æ•°æ®å°†ä¸¢å¤± |
| ç±»å‹æ”¶ç¼© (VARCHAR(100)â†’VARCHAR(50)) | ğŸ”´ å±é™© | å¯èƒ½å¯¼è‡´æ•°æ®æˆªæ–­ |
| NOT NULL å˜æ›´ | ğŸŸ¡ è­¦å‘Š | ç°æœ‰NULLå€¼éœ€å¤„ç† |
| ç±»å‹æ‰©å±• (INTâ†’BIGINT) | ğŸŸ¢ å®‰å…¨ | é€šå¸¸å®‰å…¨ |
| æ·»åŠ ç´¢å¼• | ğŸŸ¢ å®‰å…¨ | å¯èƒ½å½±å“å†™å…¥æ€§èƒ½ |

### 3.4 SQLç”Ÿæˆå™¨ (`sqlgen`)

**èŒè´£**: æ ¹æ®å·®å¼‚ç”Ÿæˆå¯æ‰§è¡Œçš„å‡çº§SQLè„šæœ¬

**æ ¸å¿ƒåŠŸèƒ½**:

1. **ä¾èµ–æ’åº**: è‡ªåŠ¨å¤„ç†å¯¹è±¡ä¾èµ–å…³ç³»ï¼ˆå…ˆåˆ å¤–é”®â†’æ”¹è¡¨â†’å†å»ºå¤–é”®ï¼‰
2. **äº‹åŠ¡åŒ…è£…**: æ”¯æŒäº‹åŠ¡æ¨¡å¼ï¼ˆæ³¨æ„MySQL DDLçš„é™åˆ¶ï¼‰
3. **å›æ»šè„šæœ¬**: å¯é€‰ç”Ÿæˆdown migrationè„šæœ¬
4. **åˆ†æ‰¹æ‰§è¡Œ**: å¤§è¡¨å˜æ›´æ”¯æŒpt-online-schema-changeé£æ ¼

```go
type SQLGenerator interface {
    Generate(diff *SchemaDiff, options GenerateOptions) (*MigrationScript, error)
}

type GenerateOptions struct {
    IncludeRollback  bool              // æ˜¯å¦ç”Ÿæˆå›æ»šè„šæœ¬
    WrapTransaction  bool              // æ˜¯å¦åŒ…è£…äº‹åŠ¡
    AddComments      bool              // æ˜¯å¦æ·»åŠ æ³¨é‡Šè¯´æ˜
    SafeMode         bool              // å®‰å…¨æ¨¡å¼ï¼ˆå±é™©æ“ä½œéœ€ç¡®è®¤ï¼‰
    OnlineMode       bool              // åœ¨çº¿å˜æ›´æ¨¡å¼ï¼ˆå¤§è¡¨å‹å¥½ï¼‰
}

type MigrationScript struct {
    Version     string
    Description string
    UpSQL       string                // å‡çº§è„šæœ¬
    DownSQL     string                // å›æ»šè„šæœ¬ï¼ˆå¯é€‰ï¼‰
    Statements  []SQLStatement        // æ‹†åˆ†çš„è¯­å¥åˆ—è¡¨
    Warnings    []string              // è­¦å‘Šä¿¡æ¯
    EstimatedTime time.Duration       // é¢„ä¼°æ‰§è¡Œæ—¶é—´
}

type SQLStatement struct {
    SQL         string
    ObjectType  string                // TABLE, INDEX, VIEW...
    ObjectName  string
    Operation   string                // CREATE, ALTER, DROP
    Severity    DiffSeverity
    Comment     string
}
```

### 3.5 DockeréªŒè¯ç¯å¢ƒ (`docker`)

**èŒè´£**: ç®¡ç†Dockerå®¹å™¨ç”Ÿå‘½å‘¨æœŸï¼Œæä¾›éš”ç¦»çš„éªŒè¯ç¯å¢ƒ

**å·¥ä½œæµç¨‹**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. å¯åŠ¨å®¹å™¨  â”‚ â”€â”€â–¶ â”‚ 2. åˆå§‹åŒ–   â”‚ â”€â”€â–¶ â”‚ 3. æ‰§è¡Œè„šæœ¬  â”‚
â”‚ MySQLé•œåƒ   â”‚     â”‚ ç›®æ ‡Schema  â”‚     â”‚ å‡çº§SQL     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                â”‚
                                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. æ¸…ç†å®¹å™¨  â”‚ â—€â”€â”€ â”‚ 5. ç”ŸæˆæŠ¥å‘Š  â”‚ â—€â”€â”€ â”‚ 4. éªŒè¯ç»“æœ  â”‚
â”‚             â”‚     â”‚             â”‚     â”‚ Schemaä¸€è‡´æ€§ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```go
type DockerManager interface {
    // å®¹å™¨ç”Ÿå‘½å‘¨æœŸ
    CreateContainer(config ContainerConfig) (string, error)
    StartContainer(containerID string) error
    StopContainer(containerID string) error
    RemoveContainer(containerID string) error
    
    // æ•°æ®åº“æ“ä½œ
    WaitForMySQL(containerID string, timeout time.Duration) error
    ExecuteSQL(containerID string, sql string) (*ExecutionResult, error)
    ImportSchema(containerID string, schema *DatabaseSchema) error
    ExportSchema(containerID string) (*DatabaseSchema, error)
}

type ContainerConfig struct {
    MySQLVersion string            // ä¸ç”Ÿäº§ç¯å¢ƒä¸€è‡´
    MySQLImage   string            // å¦‚ mysql:8.0.35
    Port         int               // æ˜ å°„ç«¯å£
    RootPassword string
    Database     string
    Charset      string
    Collation    string
    SQLMode      string            // MySQL SQLæ¨¡å¼
    Timeout      time.Duration     // å¯åŠ¨è¶…æ—¶
}

type ValidationResult struct {
    Success        bool
    ExecutionLog   []ExecutionLogEntry
    Errors         []string
    Warnings       []string
    SchemaMatch    bool              // éªŒè¯åSchemaæ˜¯å¦ä¸é¢„æœŸä¸€è‡´
    ExecutionTime  time.Duration
    ContainerLog   string
}
```

### 3.6 GUIç•Œé¢è®¾è®¡ (`gui`)

**ä½¿ç”¨Fyne v2.7.xæ„å»º**

#### ä¸»ç•Œé¢å¸ƒå±€:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SchemaPatch - MySQLæ•°æ®åº“å¯¹æ¯”å·¥å…·                          [â”€][â–¡][Ã—]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [é¡¹ç›®] â–¼    [ğŸ“ æ–°å»º] [ğŸ“‚ æ‰“å¼€] [ğŸ’¾ ä¿å­˜]                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ç¯å¢ƒé…ç½®                                                        â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚ â”‚
â”‚ â”‚ â”‚ ğŸ“— å¼€å‘ç¯å¢ƒ         â”‚ âŸ·  â”‚ ğŸ“• ç”Ÿäº§ç¯å¢ƒ         â”‚              â”‚ â”‚
â”‚ â”‚ â”‚ Host: dev-mysql     â”‚    â”‚ Host: prod-mysql    â”‚              â”‚ â”‚
â”‚ â”‚ â”‚ DB: myapp_dev       â”‚    â”‚ DB: myapp_prod      â”‚              â”‚ â”‚
â”‚ â”‚ â”‚ Version: 8.0.35     â”‚    â”‚ Version: 8.0.35     â”‚              â”‚ â”‚
â”‚ â”‚ â”‚ [ğŸ”— æµ‹è¯•è¿æ¥]       â”‚    â”‚ [ğŸ”— æµ‹è¯•è¿æ¥]       â”‚              â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ â”‚
â”‚ â”‚                    [ğŸ” å¼€å§‹å¯¹æ¯”]                                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ å·®å¼‚ç»“æœ                                              [å±•å¼€å…¨éƒ¨] â”‚ â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚ â”‚ â–¼ ğŸ“‹ è¡¨ (Tables)                                   12 é¡¹å·®å¼‚   â”‚ â”‚
â”‚ â”‚   â”‚ â”œâ”€ ğŸŸ¢ users               [æ–°å¢åˆ—: avatar_url]              â”‚ â”‚
â”‚ â”‚   â”‚ â”œâ”€ ğŸŸ¡ orders              [ä¿®æ”¹åˆ—: amount DECIMALâ†’BIGINT]   â”‚ â”‚
â”‚ â”‚   â”‚ â”œâ”€ ğŸ”´ temp_logs           [åˆ é™¤è¡¨]                         â”‚ â”‚
â”‚ â”‚   â”‚ â””â”€ ...                                                      â”‚ â”‚
â”‚ â”‚ â–¶ ğŸ“Š è§†å›¾ (Views)                                    3 é¡¹å·®å¼‚   â”‚ â”‚
â”‚ â”‚ â–¶ âš™ï¸ å­˜å‚¨è¿‡ç¨‹ (Procedures)                           1 é¡¹å·®å¼‚   â”‚ â”‚
â”‚ â”‚ â–¶ ğŸ”— ç´¢å¼• (Indexes)                                  5 é¡¹å·®å¼‚   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ å‡çº§è„šæœ¬é¢„è§ˆ                                                     â”‚ â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚ â”‚ -- Migration: dev â†’ prod                                        â”‚ â”‚
â”‚ â”‚ -- Generated: 2026-01-19 14:30:00                               â”‚ â”‚
â”‚ â”‚ -- Statements: 21                                               â”‚ â”‚
â”‚ â”‚                                                                 â”‚ â”‚
â”‚ â”‚ ALTER TABLE `users`                                             â”‚ â”‚
â”‚ â”‚   ADD COLUMN `avatar_url` VARCHAR(500) NULL AFTER `email`;     â”‚ â”‚
â”‚ â”‚                                                                 â”‚ â”‚
â”‚ â”‚ ALTER TABLE `orders`                                            â”‚ â”‚
â”‚ â”‚   MODIFY COLUMN `amount` BIGINT NOT NULL;                       â”‚ â”‚
â”‚ â”‚ ...                                                             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ [ğŸ“ ç”Ÿæˆè„šæœ¬]  [ğŸ³ DockeréªŒè¯]  [ğŸ“Š å¯¼å‡ºæŠ¥å‘Š]  [âš¡ æ‰§è¡Œå‡çº§]  â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ çŠ¶æ€: âœ… å¯¹æ¯”å®Œæˆ | å·®å¼‚: 21é¡¹ | é£é™©: ğŸ”´2 ğŸŸ¡5 ğŸŸ¢14               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### DockeréªŒè¯å¼¹çª—:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ³ DockeréªŒè¯ç¯å¢ƒ                                     [Ã—] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  MySQLç‰ˆæœ¬: [8.0.35        â–¼]                               â”‚
â”‚  éªŒè¯æ¨¡å¼: â—‹ å¿«é€ŸéªŒè¯ (ä»…è¯­æ³•)  â— å®Œæ•´éªŒè¯ (å«Schemaå¯¹æ¯”)   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æ‰§è¡Œæ—¥å¿—                                            â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚   â”‚
â”‚  â”‚ [14:32:01] ğŸ³ å¯åŠ¨MySQLå®¹å™¨...                      â”‚   â”‚
â”‚  â”‚ [14:32:05] âœ… å®¹å™¨å¯åŠ¨æˆåŠŸ                          â”‚   â”‚
â”‚  â”‚ [14:32:06] ğŸ“¥ å¯¼å…¥ç›®æ ‡Schema...                     â”‚   â”‚
â”‚  â”‚ [14:32:08] âœ… Schemaå¯¼å…¥å®Œæˆ                        â”‚   â”‚
â”‚  â”‚ [14:32:08] â–¶ï¸ æ‰§è¡Œå‡çº§è„šæœ¬ (1/21)...                â”‚   â”‚
â”‚  â”‚ [14:32:09] âœ… ALTER TABLE users - æˆåŠŸ              â”‚   â”‚
â”‚  â”‚ [14:32:09] â–¶ï¸ æ‰§è¡Œå‡çº§è„šæœ¬ (2/21)...                â”‚   â”‚
â”‚  â”‚ [14:32:10] âœ… ALTER TABLE orders - æˆåŠŸ             â”‚   â”‚
â”‚  â”‚ ...                                                 â”‚   â”‚
â”‚  â”‚ [14:32:15] ğŸ” éªŒè¯Schemaä¸€è‡´æ€§...                   â”‚   â”‚
â”‚  â”‚ [14:32:16] âœ… SchemaéªŒè¯é€šè¿‡                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 100%           â”‚
â”‚                                                             â”‚
â”‚  ç»“æœ: âœ… éªŒè¯é€šè¿‡ | è€—æ—¶: 15.2s | è¯­å¥: 21/21 æˆåŠŸ        â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     [ğŸ“‹ å¤åˆ¶æ—¥å¿—]    [ğŸ’¾ ä¿å­˜è„šæœ¬]    [å…³é—­]          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å››ã€é¡¹ç›®ç›®å½•ç»“æ„

```
schemapatch/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ schemapatch/
â”‚       â””â”€â”€ main.go              # åº”ç”¨å…¥å£
â”‚
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ config/                  # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ config.go            # é…ç½®ç»“æ„å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ store.go             # é…ç½®æŒä¹…åŒ–
â”‚   â”‚   â””â”€â”€ crypto.go            # å¯†ç åŠ å¯†
â”‚   â”‚
â”‚   â”œâ”€â”€ extractor/               # Schemaæå–
â”‚   â”‚   â”œâ”€â”€ extractor.go         # æå–å™¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ mysql.go             # MySQLå®ç°
â”‚   â”‚   â””â”€â”€ schema.go            # Schemaæ•°æ®ç»“æ„
â”‚   â”‚
â”‚   â”œâ”€â”€ diff/                    # å·®å¼‚åˆ†æ
â”‚   â”‚   â”œâ”€â”€ diff.go              # å·®å¼‚åˆ†æå¼•æ“
â”‚   â”‚   â”œâ”€â”€ compare.go           # å¯¹æ¯”ç®—æ³•
â”‚   â”‚   â”œâ”€â”€ types.go             # å·®å¼‚ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ risk.go              # é£é™©è¯„ä¼°
â”‚   â”‚
â”‚   â”œâ”€â”€ sqlgen/                  # SQLç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ generator.go         # ç”Ÿæˆå™¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ mysql.go             # MySQL DDLç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ order.go             # ä¾èµ–æ’åº
â”‚   â”‚   â””â”€â”€ templates.go         # SQLæ¨¡æ¿
â”‚   â”‚
â”‚   â”œâ”€â”€ docker/                  # Dockerç®¡ç†
â”‚   â”‚   â”œâ”€â”€ manager.go           # å®¹å™¨ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ mysql.go             # MySQLå®¹å™¨æ“ä½œ
â”‚   â”‚   â””â”€â”€ validator.go         # éªŒè¯æ‰§è¡Œ
â”‚   â”‚
â”‚   â”œâ”€â”€ report/                  # æŠ¥å‘Šç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ generator.go         # æŠ¥å‘Šç”Ÿæˆå™¨
â”‚   â”‚   â”œâ”€â”€ html.go              # HTMLæŠ¥å‘Š
â”‚   â”‚   â””â”€â”€ markdown.go          # MarkdownæŠ¥å‘Š
â”‚   â”‚
â”‚   â””â”€â”€ gui/                     # Fyne GUI
â”‚       â”œâ”€â”€ app.go               # åº”ç”¨ä¸»ä½“
â”‚       â”œâ”€â”€ window.go            # ä¸»çª—å£
â”‚       â”œâ”€â”€ theme.go             # è‡ªå®šä¹‰ä¸»é¢˜
â”‚       â”œâ”€â”€ components/          # UIç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ env_panel.go     # ç¯å¢ƒé…ç½®é¢æ¿
â”‚       â”‚   â”œâ”€â”€ diff_tree.go     # å·®å¼‚æ ‘è§†å›¾
â”‚       â”‚   â”œâ”€â”€ sql_preview.go   # SQLé¢„è§ˆ
â”‚       â”‚   â”œâ”€â”€ docker_dialog.go # DockeréªŒè¯å¯¹è¯æ¡†
â”‚       â”‚   â””â”€â”€ progress.go      # è¿›åº¦æŒ‡ç¤ºå™¨
â”‚       â””â”€â”€ icons/               # å›¾æ ‡èµ„æº
â”‚
â”œâ”€â”€ pkg/                         # å¯å¤ç”¨çš„å…¬å…±åŒ…
â”‚   â”œâ”€â”€ mysql/                   # MySQLå·¥å…·å‡½æ•°
â”‚   â””â”€â”€ utils/                   # é€šç”¨å·¥å…·
â”‚
â”œâ”€â”€ configs/                     # é…ç½®æ–‡ä»¶æ¨¡æ¿
â”‚   â””â”€â”€ default.yaml
â”‚
â”œâ”€â”€ scripts/                     # è¾…åŠ©è„šæœ¬
â”‚   â””â”€â”€ docker-compose.yml       # å¼€å‘ç”¨Dockeré…ç½®
â”‚
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â””â”€â”€ README.md
```

---

## äº”ã€æŠ€æœ¯é€‰å‹æ€»ç»“

| ç»„ä»¶ | æ¨èæ–¹æ¡ˆ | è¯´æ˜ |
|-----|---------|------|
| **GUIæ¡†æ¶** | Fyne v2.7.x | æœ€æ–°ç¨³å®šç‰ˆï¼Œè·¨å¹³å°æ”¯æŒå¥½ |
| **MySQLé©±åŠ¨** | go-sql-driver/mysql | Goæ ‡å‡†MySQLé©±åŠ¨ |
| **Schema Diff** | è‡ªç ” + å‚è€ƒschemalex | schemalexå¯ä½œä¸ºå‚è€ƒï¼Œä½†å»ºè®®è‡ªç ”ä»¥è·å¾—æ›´å¥½çš„æ§åˆ¶ |
| **Dockerç®¡ç†** | Docker SDK for Go | docker/docker/client åŒ… |
| **é…ç½®å­˜å‚¨** | YAML + SQLite | YAMLå­˜ç¯å¢ƒé…ç½®ï¼ŒSQLiteå­˜å†å²è®°å½• |
| **æ—¥å¿—** | zap | é«˜æ€§èƒ½ç»“æ„åŒ–æ—¥å¿— |
| **å¯†ç åŠ å¯†** | golang.org/x/crypto | ä½¿ç”¨AES-GCMåŠ å¯†æ•æ„Ÿä¿¡æ¯ |

---

## å…­ã€å¼€å‘é‡Œç¨‹ç¢‘è§„åˆ’

### Phase 1: åŸºç¡€æ¶æ„ (2å‘¨)

- [ ] é¡¹ç›®éª¨æ¶æ­å»º
- [ ] é…ç½®ç®¡ç†æ¨¡å—
- [ ] MySQLè¿æ¥ä¸Schemaæå–
- [ ] åŸºç¡€GUIæ¡†æ¶ï¼ˆç¯å¢ƒé…ç½®ç•Œé¢ï¼‰

### Phase 2: æ ¸å¿ƒåŠŸèƒ½ (3å‘¨)

- [ ] å·®å¼‚åˆ†æå¼•æ“
- [ ] SQLè„šæœ¬ç”Ÿæˆå™¨
- [ ] å·®å¼‚å±•ç¤ºUIï¼ˆæ ‘å½¢è§†å›¾ï¼‰
- [ ] SQLé¢„è§ˆç•Œé¢

### Phase 3: DockeréªŒè¯ (2å‘¨)

- [ ] Dockerå®¹å™¨ç®¡ç†
- [ ] éªŒè¯æ‰§è¡Œæµç¨‹
- [ ] éªŒè¯ç»“æœå±•ç¤º
- [ ] é”™è¯¯å¤„ç†ä¸æ—¥å¿—

### Phase 4: å®Œå–„ä¸ä¼˜åŒ– (2å‘¨)

- [ ] æŠ¥å‘Šå¯¼å‡ºåŠŸèƒ½
- [ ] å¿½ç•¥è§„åˆ™é…ç½®
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] æµ‹è¯•ä¸Bugä¿®å¤

### Phase 5: æ‰©å±•åŠŸèƒ½ (å¯é€‰)

- [ ] å‘½ä»¤è¡Œæ¨¡å¼ï¼ˆCI/CDé›†æˆï¼‰
- [ ] å¤šæ•°æ®åº“æ”¯æŒï¼ˆMariaDBï¼‰
- [ ] å†å²è®°å½•ä¸ç‰ˆæœ¬ç®¡ç†

---

## ä¸ƒã€å…³é”®é£é™©ä¸åº”å¯¹ç­–ç•¥

| é£é™© | å½±å“ | åº”å¯¹ç­–ç•¥ |
|-----|------|---------|
| **æ•°æ®ä¸¢å¤±** | åˆ é™¤è¡¨/åˆ—å¯¼è‡´æ•°æ®æ°¸ä¹…ä¸¢å¤± | å±é™©æ“ä½œäºŒæ¬¡ç¡®è®¤ + è‡ªåŠ¨å¤‡ä»½æé†’ + é†’ç›®æ ‡çº¢ |
| **ç±»å‹ä¸å…¼å®¹** | æ•°æ®æˆªæ–­æˆ–è½¬æ¢å¤±è´¥ | è‡ªåŠ¨æ£€æµ‹é£é™© + å»ºè®®æ•°æ®è¿ç§»è„šæœ¬ |
| **æ‰§è¡Œé¡ºåºé”™è¯¯** | å¤–é”®çº¦æŸå¯¼è‡´æ‰§è¡Œå¤±è´¥ | ä¾èµ–åˆ†æ + æ™ºèƒ½æ’åº + äº‹åŠ¡åŒ…è£… |
| **ç¯å¢ƒå·®å¼‚** | éªŒè¯é€šè¿‡ä½†ç”Ÿäº§å¤±è´¥ | å¼ºåˆ¶ç‰ˆæœ¬åŒ¹é… + SQL Modeä¸€è‡´æ€§æ£€æŸ¥ |
| **å¤§è¡¨å˜æ›´** | é”è¡¨æ—¶é—´è¿‡é•¿ | æ”¯æŒpt-online-schema-changeæ¨¡å¼ |

---

## å…«ã€UI/UXè®¾è®¡å»ºè®®

### 8.1 é…è‰²æ–¹æ¡ˆ

é‡‡ç”¨æ·±è‰²ä¸»é¢˜ï¼Œå‡å°‘è§†è§‰ç–²åŠ³ï¼š

- ä¸»è‰²: `#1E1E2E` (èƒŒæ™¯)
- å¼ºè°ƒè‰²: `#89B4FA` (ä¿¡æ¯), `#F9E2AF` (è­¦å‘Š), `#F38BA8` (å±é™©)

### 8.2 å·®å¼‚é«˜äº®

- ğŸŸ¢ ç»¿è‰²: æ–°å¢/å®‰å…¨
- ğŸŸ¡ é»„è‰²: ä¿®æ”¹/è­¦å‘Š
- ğŸ”´ çº¢è‰²: åˆ é™¤/å±é™©

### 8.3 äº¤äº’åŸåˆ™

- å±é™©æ“ä½œéœ€è¦æ˜ç¡®ç¡®è®¤
- é•¿æ—¶é—´æ“ä½œæ˜¾ç¤ºè¿›åº¦
- é”™è¯¯ä¿¡æ¯æ¸…æ™°å¯æ“ä½œ

---

## ä¹ã€æ ¸å¿ƒæµç¨‹å›¾

### 9.1 å®Œæ•´å·¥ä½œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é…ç½®ç¯å¢ƒ   â”‚ â”€â”€â–¶ â”‚  è¿æ¥æµ‹è¯•   â”‚ â”€â”€â–¶ â”‚  æå–Schema â”‚
â”‚  Dev/Prod   â”‚     â”‚             â”‚     â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¯¼å‡ºæŠ¥å‘Š   â”‚ â—€â”€â”€ â”‚  å·®å¼‚å±•ç¤º   â”‚ â—€â”€â”€ â”‚  å·®å¼‚åˆ†æ   â”‚
â”‚  (å¯é€‰)     â”‚     â”‚  æ ‘å½¢/åˆ—è¡¨  â”‚     â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº”ç”¨åˆ°ç”Ÿäº§ â”‚ â—€â”€â”€ â”‚ DockeréªŒè¯  â”‚ â—€â”€â”€ â”‚  ç”ŸæˆSQL    â”‚
â”‚  (ç¡®è®¤å)   â”‚     â”‚  (è‡ªåŠ¨)     â”‚     â”‚  å‡çº§è„šæœ¬   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 DockeréªŒè¯è¯¦ç»†æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DockeréªŒè¯æµç¨‹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1. æ‹‰å–MySQLé•œåƒ (å¦‚æœä¸å­˜åœ¨)                              â”‚
â”‚     â””â”€â–¶ mysql:8.0.35                                       â”‚
â”‚                                                             â”‚
â”‚  2. åˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨                                          â”‚
â”‚     â””â”€â–¶ é…ç½®: ç«¯å£æ˜ å°„, å­—ç¬¦é›†, SQL Mode                   â”‚
â”‚                                                             â”‚
â”‚  3. ç­‰å¾…MySQLå°±ç»ª                                           â”‚
â”‚     â””â”€â–¶ å¥åº·æ£€æŸ¥ (æœ€å¤šç­‰å¾…60ç§’)                            â”‚
â”‚                                                             â”‚
â”‚  4. å¯¼å…¥ç›®æ ‡ç¯å¢ƒSchema (ç”Ÿäº§ç¯å¢ƒå½“å‰çŠ¶æ€)                   â”‚
â”‚     â””â”€â–¶ æ‰§è¡ŒCREATE TABLE/VIEW/PROCEDURE...                 â”‚
â”‚                                                             â”‚
â”‚  5. æ‰§è¡Œå‡çº§SQLè„šæœ¬                                         â”‚
â”‚     â””â”€â–¶ é€æ¡æ‰§è¡Œï¼Œè®°å½•ç»“æœ                                 â”‚
â”‚     â””â”€â–¶ æ•è·é”™è¯¯ï¼Œè®°å½•æ—¥å¿—                                 â”‚
â”‚                                                             â”‚
â”‚  6. éªŒè¯ç»“æœ                                                â”‚
â”‚     â””â”€â–¶ é‡æ–°æå–Schema                                     â”‚
â”‚     â””â”€â–¶ ä¸é¢„æœŸSchemaå¯¹æ¯”                                   â”‚
â”‚     â””â”€â–¶ ç”ŸæˆéªŒè¯æŠ¥å‘Š                                       â”‚
â”‚                                                             â”‚
â”‚  7. æ¸…ç†å®¹å™¨                                                â”‚
â”‚     â””â”€â–¶ åœæ­¢å¹¶åˆ é™¤å®¹å™¨                                     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åã€APIæ¥å£è®¾è®¡

### 10.1 æ ¸å¿ƒæœåŠ¡æ¥å£

```go
// SchemaService - Schemaç›¸å…³æ“ä½œ
type SchemaService interface {
    // æå–æŒ‡å®šç¯å¢ƒçš„Schema
    Extract(ctx context.Context, envID string) (*DatabaseSchema, error)
    
    // å¯¹æ¯”ä¸¤ä¸ªç¯å¢ƒçš„Schema
    Compare(ctx context.Context, sourceEnvID, targetEnvID string) (*SchemaDiff, error)
    
    // ç”Ÿæˆå‡çº§SQL
    GenerateSQL(ctx context.Context, diff *SchemaDiff, opts GenerateOptions) (*MigrationScript, error)
}

// ValidationService - éªŒè¯ç›¸å…³æ“ä½œ
type ValidationService interface {
    // åœ¨Dockerä¸­éªŒè¯SQLè„šæœ¬
    Validate(ctx context.Context, script *MigrationScript, opts ValidationOptions) (*ValidationResult, error)
    
    // è·å–éªŒè¯è¿›åº¦
    GetProgress(ctx context.Context, taskID string) (*ValidationProgress, error)
    
    // å–æ¶ˆéªŒè¯ä»»åŠ¡
    Cancel(ctx context.Context, taskID string) error
}

// ProjectService - é¡¹ç›®ç®¡ç†
type ProjectService interface {
    // é¡¹ç›®CRUD
    Create(ctx context.Context, project *Project) error
    Get(ctx context.Context, id string) (*Project, error)
    Update(ctx context.Context, project *Project) error
    Delete(ctx context.Context, id string) error
    List(ctx context.Context) ([]*Project, error)
    
    // ç¯å¢ƒç®¡ç†
    AddEnvironment(ctx context.Context, projectID string, env *Environment) error
    UpdateEnvironment(ctx context.Context, projectID string, env *Environment) error
    RemoveEnvironment(ctx context.Context, projectID, envID string) error
    TestConnection(ctx context.Context, env *Environment) error
}
```

---

## åä¸€ã€é…ç½®æ–‡ä»¶ç¤ºä¾‹

### 11.1 é¡¹ç›®é…ç½® (project.yaml)

```yaml
project:
  id: "proj_001"
  name: "MyApp Database"
  created_at: "2026-01-19T10:00:00Z"

environments:
  - id: "env_dev"
    name: "å¼€å‘ç¯å¢ƒ"
    type: "dev"
    host: "dev-mysql.internal"
    port: 3306
    username: "developer"
    database: "myapp_dev"
    charset: "utf8mb4"
    mysql_version: "8.0.35"
    
  - id: "env_prod"
    name: "ç”Ÿäº§ç¯å¢ƒ"
    type: "prod"
    host: "prod-mysql.internal"
    port: 3306
    username: "readonly"
    database: "myapp_prod"
    charset: "utf8mb4"
    mysql_version: "8.0.35"
    ssl_enabled: true

ignore_rules:
  tables:
    - "temp_*"           # å¿½ç•¥æ‰€æœ‰temp_å¼€å¤´çš„è¡¨
    - "log_*"            # å¿½ç•¥æ‰€æœ‰log_å¼€å¤´çš„è¡¨
  columns:
    - "*.created_at"     # å¿½ç•¥æ‰€æœ‰è¡¨çš„created_atåˆ—å˜æ›´
    - "*.updated_at"
  ignore_comments: true
  ignore_auto_increment: true
  ignore_collation: false

docker:
  mysql_image: "mysql:8.0.35"
  timeout: "60s"
  cleanup: true
```

---

## åäºŒã€é”™è¯¯å¤„ç†ç­–ç•¥

### 12.1 é”™è¯¯åˆ†ç±»

| é”™è¯¯ç±»å‹ | å¤„ç†æ–¹å¼ | ç”¨æˆ·æç¤º |
|---------|---------|---------|
| è¿æ¥å¤±è´¥ | é‡è¯•3æ¬¡åæ”¾å¼ƒ | æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ï¼Œå»ºè®®æ£€æŸ¥ç½‘ç»œ/å‡­æ® |
| Schemaæå–å¤±è´¥ | è®°å½•æ—¥å¿—ï¼Œç»ˆæ­¢æµç¨‹ | æ˜¾ç¤ºå¤±è´¥çš„å¯¹è±¡ï¼Œå»ºè®®æ£€æŸ¥æƒé™ |
| SQLæ‰§è¡Œå¤±è´¥ | è®°å½•é”™è¯¯ï¼Œç»§ç»­æ‰§è¡Œå…¶ä»–è¯­å¥ | æ˜¾ç¤ºå¤±è´¥è¯­å¥å’Œé”™è¯¯åŸå›  |
| Dockerå¯åŠ¨å¤±è´¥ | æ£€æŸ¥DockerçŠ¶æ€ | æç¤ºå®‰è£…/å¯åŠ¨Docker |
| éªŒè¯è¶…æ—¶ | æ¸…ç†å®¹å™¨ï¼Œç»ˆæ­¢éªŒè¯ | æç¤ºå¢åŠ è¶…æ—¶æ—¶é—´æˆ–ä¼˜åŒ–è„šæœ¬ |

### 12.2 æ—¥å¿—è®°å½•

```go
// æ—¥å¿—çº§åˆ«å’Œå†…å®¹
type LogEntry struct {
    Timestamp time.Time
    Level     LogLevel      // DEBUG, INFO, WARN, ERROR
    Module    string        // extractor, diff, sqlgen, docker, gui
    Message   string
    Details   map[string]interface{}
    Error     error
}
```

---

## åä¸‰ã€å®‰å…¨è€ƒè™‘

1. **å¯†ç å­˜å‚¨**: ä½¿ç”¨AES-GCMåŠ å¯†å­˜å‚¨æ•°æ®åº“å¯†ç 
2. **è¿æ¥å®‰å…¨**: æ”¯æŒSSL/TLSè¿æ¥
3. **æƒé™æ§åˆ¶**: ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨åªè¯»è´¦å·æå–Schema
4. **æ“ä½œå®¡è®¡**: è®°å½•æ‰€æœ‰æ•æ„Ÿæ“ä½œï¼ˆç”ŸæˆSQLã€æ‰§è¡ŒéªŒè¯ç­‰ï¼‰
5. **å±é™©æ“ä½œç¡®è®¤**: DROP TABLE/COLUMNç­‰æ“ä½œéœ€è¦äºŒæ¬¡ç¡®è®¤

---

## åå››ã€æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **å¹¶è¡Œæå–**: å¤šä¸ªè¡¨çš„Schemaå¯ä»¥å¹¶è¡Œæå–
2. **å¢é‡å¯¹æ¯”**: æ”¯æŒåŸºäºä¸Šæ¬¡å¯¹æ¯”ç»“æœçš„å¢é‡å¯¹æ¯”
3. **Schemaç¼“å­˜**: ç¼“å­˜æœ€è¿‘æå–çš„Schemaï¼Œé¿å…é‡å¤æå–
4. **å¤§è¡¨å¤„ç†**: å¯¹äºå¤§è¡¨çš„ALTERæ“ä½œï¼Œæä¾›pt-online-schema-changeå»ºè®®
5. **è¿æ¥æ± **: ä½¿ç”¨è¿æ¥æ± ç®¡ç†æ•°æ®åº“è¿æ¥

---

## åäº”ã€æœªæ¥æ‰©å±•æ–¹å‘

1. **å¤šæ•°æ®åº“æ”¯æŒ**: MariaDB, PostgreSQL, SQLite
2. **æ•°æ®å¯¹æ¯”**: ä¸ä»…å¯¹æ¯”ç»“æ„ï¼Œè¿˜å¯ä»¥å¯¹æ¯”å…³é”®æ•°æ®
3. **ç‰ˆæœ¬æ§åˆ¶é›†æˆ**: ä¸Gité›†æˆï¼Œè‡ªåŠ¨ç”Ÿæˆmigrationæ–‡ä»¶
4. **CI/CDé›†æˆ**: æä¾›å‘½ä»¤è¡Œå·¥å…·ï¼Œæ”¯æŒè‡ªåŠ¨åŒ–æµæ°´çº¿
5. **å›¢é˜Ÿåä½œ**: æ”¯æŒå¤šç”¨æˆ·ï¼Œå¯¹æ¯”ç»“æœå…±äº«å’Œå®¡æ‰¹æµç¨‹
6. **äº‘æ•°æ®åº“æ”¯æŒ**: AWS RDS, é˜¿é‡Œäº‘RDS, è…¾è®¯äº‘MySQLç­‰
